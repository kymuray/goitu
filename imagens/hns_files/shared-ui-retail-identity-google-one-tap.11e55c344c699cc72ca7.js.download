/*@license For license information please refer to shared-ui-retail-identity-google-one-tap.licenses.txt*/
(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[8695],{59162:function(n,e,t){t.d(e,{P:function(){return un}});var r,o,a=t(56195),i=t(64341),c=t(4611),u=t(10554),l=t(97778),s=t(91056),d=t(53017);function v(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function f(n,e,t,r,o,a,i){try{var c=n[a](i),u=c.value}catch(l){return void t(l)}c.done?e(u):Promise.resolve(u).then(r,o)}function p(n){return function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(n){f(a,r,o,i,c,"next",n)}function c(n){f(a,r,o,i,c,"throw",n)}i(void 0)})}}function g(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function y(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.forEach(function(e){g(n,e,t[e])})}return n}function m(n,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):function(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,r)}return t}(Object(e)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}),n}function O(n,e){if(null==n)return{};var t,r,o=function(n,e){if(null==n)return{};var t,r,o={},a=Object.keys(n);for(r=0;r<a.length;r++)t=a[r],e.indexOf(t)>=0||(o[t]=n[t]);return o}(n,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);for(r=0;r<a.length;r++)t=a[r],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(o[t]=n[t])}return o}function _(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=t){var r,o,a=[],i=!0,c=!1;try{for(t=t.call(n);!(i=(r=t.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(u){c=!0,o=u}finally{try{i||null==t.return||t.return()}finally{if(c)throw o}}return a}}(n,e)||function(n,e){if(!n)return;if("string"==typeof n)return v(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);"Object"===t&&n.constructor&&(t=n.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return v(n,e)}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(n,e){return e||(e=n.slice(0)),Object.freeze(Object.defineProperties(n,{raw:{value:Object.freeze(e)}}))}function h(n,e){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(n,i)}catch(c){a=[6,c],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function w(){var n=b(["\n  fragment IdentityAnalyticsInteractionEventFragment on IdentityAnalyticsInteractionEvent {\n    eventName\n    eventVersion\n    payload\n  }\n"]);return w=function(){return n},n}function I(){var n=b(["\n  fragment IdentityAnalyticsOutcomeEventFragment on IdentityAnalyticsOutcomeEvent {\n    eventName\n    eventVersion\n    payload\n  }\n"]);return I=function(){return n},n}function E(){var n=b(["\n  fragment IdentityOneTapSubmitActionFragment on IdentityOneTapSubmitAction {\n    atoActions {\n      ... on IdentityCsrfWidgetAction {\n        inputKeys\n        token\n        type\n      }\n    }\n    nonce\n    context\n    clickStreamAnalytics {\n      ...IdentityAnalyticsInteractionEventFragment\n      ...IdentityAnalyticsOutcomeEventFragment\n    }\n  }\n  ","\n  ","\n"]);return E=function(){return n},n}function T(){var n=b(["\n  mutation GoogleOneTapSubmit($context: ContextInput!, $submitRequest: IdentitySubmitRequestInput!) {\n    googleOneTapSubmit(context: $context, submitRequest: $submitRequest) {\n      ... on IdentityGoogleOneTapMutationResponse {\n        analytics {\n          ...IdentityAnalyticsOutcomeEventFragment\n        }\n        cmsToken\n        flow\n        scenario\n        success\n        variant\n      }\n    }\n  }\n  ","\n"]);return T=function(){return n},n}function A(){var n=b(["\n  fragment IdentityAnalyticsImpressionEventFragment on IdentityAnalyticsImpressionEvent {\n    eventName\n    eventVersion\n    payload\n  }\n"]);return A=function(){return n},n}function S(){var n=b(["\n  fragment IdentityGoogleOneTapResponseFragment on IdentityGoogleOneTapResponse {\n    analytics {\n      ...IdentityAnalyticsImpressionEventFragment\n      ...IdentityAnalyticsInteractionEventFragment\n    }\n    configuration {\n      clientId\n    }\n    action {\n      ...IdentityOneTapSubmitActionFragment\n    }\n    allowIntelligentTrackingPrevention\n  }\n\n  ","\n  ","\n  ","\n"]);return S=function(){return n},n}function R(){var n=b(["\n  query GoogleOneTapQuery($context: ContextInput!) {\n    googleOneTap(context: $context) {\n      ...IdentityGoogleOneTapResponseFragment\n    }\n  }\n\n  ","\n"]);return R=function(){return n},n}(o=r||(r={})).CRITICAL="CRITICAL",o.ERROR="ERROR",o.WARN="WARN",o.INFO="INFO",o.UNKNOWN="UNKNOWN";var N=function(){function n(n,e){this.level=n,this.name=e}return n.prototype.toString=function(){return"SystemEvent(level="+this.level.toString()+" name="+this.name+")"},n}(),k=function(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var r,o,a=t.call(n),i=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(c){o={error:c}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},x=function(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(k(arguments[e]));return n},C=function(n){var e=this;this.event=n.event||function(){};var t=function(n,t){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];e.event&&e.event.apply(e,x([new N(n,t)],r))};this.info=n.info||function(n){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];return t.apply(void 0,x([r.INFO,n],e))},this.warning=n.warning||function(n){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];return t.apply(void 0,x([r.WARN,n],e))},this.error=n.error||function(n){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];return t.apply(void 0,x([r.ERROR,n],e))}},D=new C({});a.createContext(D),new N(r.ERROR,"IDENTITY_ATO_SCRIPT_ERROR");var P,j,L,F,G=function(n){var e=function(n){var e=n.event_data.event,t=e.event_type,r=e.event_name,o=e.event_category,a=e.event_version,i=e.action_location,c=e.action_reason,u=e.event_producer,l=n.event_data.experience;return{event:{event_type:t,event_name:r,event_category:o,event_version:a,action_location:i,event_producer:u,action_reason:c},experience:{page_name:l.page_name,page_name_detailed:l.page_name_detailed}}}(n);return"additional_context"in n.event_data&&(e.additional_context=n.event_data.additional_context),"form"in n.event_data&&(e.form=n.event_data.form),"user"in n.event_data&&(e.user=n.event_data.user),"error_list"in n.event_data&&(e.error_list=n.event_data.error_list),e},W=function(n,e){if(n){var t=Array.isArray(e),r=t?function(n,e){var t;return null!==(t=n.find(function(n){return e.includes(n.eventName)}))&&void 0!==t?t:null}(n,e):function(n,e){var t;return null!==(t=n.find(function(n){return n.eventName===e}))&&void 0!==t?t:null}(n,e);if(null==r?void 0:r.payload){var o=t?r.eventName:e,a=function(n,e){try{var t=JSON.parse(n);return e in t.events?Object.values(t.events[e]).at(0):null}catch(r){return null}}(r.payload,o);return null!=a?a:null}}return null},U=(P=1e3,j=function(n){n()},F=(L||{}).atBegin,function(n,e,t){var r,o=t||{},a=o.noTrailing,i=void 0!==a&&a,c=o.noLeading,u=void 0!==c&&c,l=o.debounceMode,s=void 0===l?void 0:l,d=!1,v=0;function f(){r&&clearTimeout(r)}function p(){for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];var c=this,l=Date.now()-v;function p(){v=Date.now(),e.apply(c,o)}function g(){r=void 0}d||(u||!s||r||p(),f(),void 0===s&&l>n?u?(v=Date.now(),i||(r=setTimeout(s?g:p,n))):p():!0!==i&&(r=setTimeout(s?g:p,void 0===s?n-l:n)))}p.cancel=function(n){var e=(n||{}).upcomingOnly,t=void 0!==e&&e;f(),d=!t}}(P,j,{debounceMode:!1!==(void 0!==F&&F)}),{fragment:(0,c.J1)(w())}),J={fragment:(0,c.J1)(I())},K=(0,c.J1)(E(),U.fragment,J.fragment),q="__googleOneTapScript__",M="idle",$="loading",B="ready",z="error",Y="load",H="error",V="google_onetap.failed",Q=function(n){var e=n.variant,t=n.cmsToken,r=n.scenario,o=n.success,a="".concat(window.location.pathname).concat(window.location.search),i=encodeURIComponent(a);if(!o)return"/login/error?redirectTo=".concat(i,"&error=googleOneTap");switch(e){case"ONE_KEY":case"BETA_CONSENT_0":case"BETA_CONSENT_1":case"BETA_CONSENT_2":return"/onboarding?originUrl=".concat(i,"&cmsToken=").concat(t,"&scenario=").concat(r);case"ONE_IDENTITY_1":case"ONE_IDENTITY_0":case"ONE_IDENTITY_2":return function(n){var e=n.cmsToken,t=n.scenario,r=n.variant,o=n.accountMergeSharedUiExposure,a="".concat(window.location.pathname).concat(window.location.search),i=encodeURIComponent(a);return 1===(null==o?void 0:o.bucket)?"/accountmerge?redirectTo=".concat(i,"&token=").concat(e,"&scenario=").concat(t,"&variant=").concat(r):"/onboarding?originUrl=".concat(i,"&cmsToken=").concat(e,"&scenario=").concat(t)}(n);case"PASSWORD_1":case"PASSWORD_3":case"PASSWORD_0":case"PASSWORD_2":return"/addpassword?redirectTo=".concat(i,"&token=").concat(t,"&scenario=").concat(r,"&variant=").concat(e);case"PROFILE_DETAIL_0":case"PROFILE_DETAIL_1":return"/accountinfo?redirectTo=".concat(i,"&token=").concat(t,"&scenario=").concat(r,"&variant=").concat(e);case"PROFILE_DETAIL_2":return"/marketingconsent?redirectTo=".concat(i,"&token=").concat(t,"&scenario=").concat(r,"&variant=").concat(e);default:return null}},X=function(n){var e=Q(n);null===e?window.location.reload():window.location.assign(e)},Z=(0,c.J1)(T(),J.fragment),nn=function(n){var e,t,r,o,i=n.disabled,c=n.googleAccountConfigs,u=n.disableCancelOnUnmount,s=void 0!==u&&u,d=n.initialize,v=void 0!==d&&d,f=n.analytics,p=(e="https://accounts.google.com/gsi/client",t=_((0,a.useState)(e?$:M),2),r=t[0],o=t[1],(0,a.useEffect)(function(){if(e){var n=document.querySelector('script[src="'.concat(e,'"]'));if(n)o(n.getAttribute("data-status")||M);else{(n=document.createElement("script")).src=e,n.async=!0,n.setAttribute("data-status",$),document.body.appendChild(n);var t=function(e){n&&n.setAttribute("data-status",e.type===Y?B:z)};n.addEventListener(Y,t),n.addEventListener(H,t)}var r=function(n){o(n.type===Y?B:z)};return n.addEventListener(Y,r),n.addEventListener(H,r),function(){n&&(n.removeEventListener(Y,r),n.removeEventListener(H,r))}}o(M)},[e]),r),g=(0,l.useEgClickstream)();return(0,a.useEffect)(function(){var n,e,t,r,o,a,u,l,d,m;v&&!(null===(n=window)||void 0===n?void 0:n[q])&&window.google&&"ready"===p&&(null===(a=window)||void 0===a||null===(o=a.google)||void 0===o||null===(r=o.accounts)||void 0===r||null===(t=r.id)||void 0===t||t.initialize(y({},c)),window[q]=!0);if(v&&(null===(e=window)||void 0===e?void 0:e[q])&&window.google&&"ready"===p&&!i)return null===(m=window)||void 0===m||null===(d=m.google)||void 0===d||null===(l=d.accounts)||void 0===l||null===(u=l.id)||void 0===u||u.prompt(function(n){if("user_cancel"===(null==n?void 0:n.getSkippedReason())){var e=W(f,"google_onetap.closed");e&&g(G(e))}if("tap_outside"===(null==n?void 0:n.getSkippedReason())){var t=W(f,"google_onetap.hidden");t&&g(G(t))}if(null==n?void 0:n.isDisplayed()){var r=W(f,"google_onetap.presented");r&&g(G(r))}}),function(){var n,e,t,r;s||(null===(r=window)||void 0===r||null===(t=r.google)||void 0===t||null===(e=t.accounts)||void 0===e||null===(n=e.id)||void 0===n||n.cancel())}},[p,v,i,s]),null};function en(n){var e=n.children,t=void 0===e?null:e,r=O(n,["children"]);return nn(r),t}var tn={fragment:(0,c.J1)(A())},rn=(0,c.J1)(S(),tn.fragment,U.fragment,K),on=function(n){var e=n.data,t=e.configuration,r=e.analytics,o=e.action,c=e.allowIntelligentTrackingPrevention,u=(null==t?void 0:t.clientId)||"",v=c||!1,f=_((0,a.useState)(!1),2),g=f[0],O=f[1];(0,a.useEffect)(function(){O(!0)},[]);var b,w=(0,l.useEgClickstream)(),I=function(){var n,e=(0,i.R)().context,t=(0,d.useExperiment)("Onboarding_v2_Web").exposure,r=_((0,s.n)(Z),1)[0],o=(0,l.useEgClickstream)(),c=(0,a.useCallback)((n=p(function(n,a){var i,c,u,l,s,d,v,f,p,g,O,_,b,w,I,E,T,A,S;return h(this,function(h){switch(h.label){case 0:i=a.nonce,c=void 0===i?"":i,u=a.context,l=void 0===u?"":u,s=a.atoActions,d=void 0===s?[]:s,v=a.clickStreamAnalytics,f=(null==d?void 0:d.filter(function(n){return"IdentityCsrfWidgetAction"===n.__typename})[0])||{},p={type:null==(R=f)?void 0:R.type,inputs:[{key:R.inputKeys[0],value:R[R.inputKeys[0]]}]},h.label=1;case 1:return h.trys.push([1,3,,4]),[4,r({variables:{context:e,submitRequest:{context:l,atoInputs:p,socialInput:{socialType:"GOOGLE",tokenType:"ID",token:n,nonce:c},input:[]}}})];case 2:return O=h.sent(),"IdentityGoogleOneTapMutationResponse"===(null==(_=O.data)||null===(g=_.googleOneTapSubmit)||void 0===g?void 0:g.__typename)&&(b=_.googleOneTapSubmit,w=b.analytics,b.variant,b.success?((I=W(w,"google_onetap.succeeded"))&&o(G(I)),(E=W(w,"sign_up.succeeded"))&&o(G(E)),(T=W(w,"sign_in.succeeded"))&&o(G(T))):(A=W(w,V))&&o(G(A)),X(m(y({},null==_?void 0:_.googleOneTapSubmit),{accountMergeSharedUiExposure:t}))),[3,4];case 3:return h.sent(),(S=W(v,V))&&o(G(S)),X({success:!1}),[3,4];case 4:return[2]}var R})}),function(e,t){return n.apply(this,arguments)}),[e]);return{authenticateWithGoogleOneTap:c}}().authenticateWithGoogleOneTap,E=(b=p(function(n){var e,t;return h(this,function(r){switch(r.label){case 0:return(e=W(null==o?void 0:o.clickStreamAnalytics,"google_onetap.submitted"))&&w(G(e)),(null==n?void 0:n.credential)?[4,I(n.credential,o)]:[3,2];case 1:return r.sent(),[3,3];case 2:(t=W(null==o?void 0:o.clickStreamAnalytics,V))&&w(G(t)),r.label=3;case 3:return[2]}})}),function(n){return b.apply(this,arguments)});return a.createElement(en,{googleAccountConfigs:{client_id:u,callback:E,nonce:null==o?void 0:o.nonce,itp_support:v,use_fedcm_for_prompt:!1},initialize:g,analytics:r})};on.fragment=rn,on.displayName="IdentityGoogleOneTapResponse";var an=(0,c.J1)(R(),on.fragment),cn=function(n){var e,t=n.skipSsr,r=(0,i.R)().context,o={context:r},c=(0,u.I)(an,{context:r,variables:o,ssr:!t}),l=c.data,s=c.error;return c.loading||s||!l?null:"IdentityGoogleOneTapResponse"===(null===(e=l.googleOneTap)||void 0===e?void 0:e.__typename)?a.createElement(on,{data:l.googleOneTap}):null};cn.displayName="sharedui-GoogleOneTapQueryComponent";var un=function(n){var e,t=n.skipSsr,r=(0,i.R)().context;return"AUTHENTICATED"===(null==r||null===(e=r.identity)||void 0===e?void 0:e.authState)?null:a.createElement(cn,{skipSsr:t})};un.displayName="sharedui-GoogleOneTap"}}]);
//# sourceMappingURL=https://bernie-assets.s3.us-west-2.amazonaws.com/shopping-pwa/shared-ui-retail-identity-google-one-tap.11e55c344c699cc72ca7.js.map